# Planarian Detection System

プラナリア（または他の小動物）の自動検出・追跡システムです。画像解析により個体の位置・面積・活動量を自動で測定し、行動解析を行います。

## システム構成

### 1. animal_detector_gui.py - 画像検出GUI（従来手法）
- **個体検出**: 暗い背景から明るい個体、または明るい背景から暗い個体を自動検出
- **形状測定**: 重心座標、面積、長軸・短軸、真円度を計算
- **リアルタイムプレビュー**: パラメータ調整の効果を即座に確認
- **インタラクティブ学習**: プラナリアをクリックして最適なパラメータを自動推定

### 2. segmentation/ - セマンティックセグメンテーション（ディープラーニング）**NEW**
- **U-Netモデル**: ResNet34エンコーダー + ImageNet事前学習済み重み
- **高精度検出**: 夜間画像や低コントラスト画像でも高精度に検出
- **ラベリングGUI**: 100枚以上の画像を効率的にラベリング
- **学習・推論**: GPU対応（RTX 5070 Ti推奨）、Early Stopping実装
- **既存システムとの互換性**: 出力CSVは`behavior_analysis.py`で解析可能
- 詳細は `segmentation/README.md` を参照

### 3. behavior_analysis.py - 行動解析モジュール
- **時系列データ処理**: 検出結果（CSV）から時系列データを生成
- **活動量解析**: 移動距離、不動時間、活動リズムの解析
- **統計解析**: 昼夜比較、外れ値除去、統計的検定
- **可視化**: 時系列グラフ、ヒートマップ、活動パターンの可視化

## 主な機能

### 画像検出機能

### 画像検出機能

#### 二値化方式
- **relative (推奨)**: 画像の平均輝度を基準に相対的に閾値を設定
  - `relative_thresh=0.15`で平均輝度の85%を閾値とする
  - 照明条件の変動に強く、夜間の誤検出を抑制
- **adaptive**: 適応的二値化（局所的に閾値を設定）
- **fixed**: 固定閾値（非推奨）

#### 背景除去機能
- **Temporal Median Filter**: 複数フレームの中央値から背景を作成して除去
  - 動きの少ないノイズ除去に有効
  - フレーム数100枚程度を推奨
- **自動背景補正**: 各画像で自動的に背景を推定して除去
  - **adaptive** (推奨): ガウシアンブラーによる高速処理
  - **morphological**: モルフォロジー処理による背景除去
  - **rolling_ball**: Rolling Ball法（やや重い）

#### 検出精度向上機能
- **ROI（関心領域）設定**: 円形ROIで検出範囲を制限
- **エッジ強調**: Sobelフィルタで輪郭を強調（重み調整可能）
- **コントラスト調整**: CLAHE（局所適応ヒストグラム平坦化）による夜間画像の強調
- **ターゲット選択**: プラナリアをクリックして最適パラメータを自動推定

### 行動解析機能（behavior_analysis.py）

#### データ処理
- **タイムスタンプ生成**: 測定開始時刻とフレーム間隔から正確な時刻を生成
- **移動量計算**: フレーム間の重心座標から移動距離を算出
- **不動割合計算**: 設定閾値以下の移動を不動と判定
- **外れ値除去**: IQR法またはZ-score法で異常値を除外

#### 統計解析
- **時間ビン集約**: 指定間隔（デフォルト10分）でデータを集約
- **昼夜比較**: 昼夜の活動量・移動距離の統計的比較
- **活動リズム解析**: 周期性の検出、ピーク時刻の特定
- **Constant Darkness対応**: 恒常暗条件での解析にも対応

#### 可視化機能
- **時系列グラフ**: 面積・移動量の時系列変化を可視化
- **昼夜周期の表示**: グラフ上に昼夜を色分けして表示
- **統計情報の表示**: 平均値・標準偏差・最大値・最小値を表示
- **測定開始時刻マーカー**: グラフ上に測定開始時刻を表示

## 使い方

### 1. インストール

```bash
pip install -r requirements.txt
```

必要なライブラリ:
- opencv-python: 画像処理
- numpy: 数値計算
- pandas: データ処理
- matplotlib: グラフ描画
- Pillow: 画像表示
- scipy: 統計解析

### 2. 画像検出GUIの起動

```bash
python animal_detector_gui.py
```

### 3. 基本的な設定手順
- **relative (推奨)**: 画像の平均輝度を基準に相対的に閾値を設定
  - `relative_thresh=0.15`で平均輝度の85%を閾値とする
  - 照明条件の変動に強く、夜間の誤検出を抑制
- **adaptive**: 適応的二値化（局所的に閾値を設定）
- **fixed**: 固定閾値（非推奨）

#### 背景除去
- **Temporal Median Filter**: 複数フレームの中央値から背景を作成して除去（動きの少ないノイズ除去に有効）
- **Gaussian Blur**: ガウシアンブラーによる簡易的な背景除去

### 3. ROI（関心領域）設定
- 円形ROIを設定可能
- ROI外の領域を無視することで誤検出を削減

### 4. コントラスト調整
- 基本的なコントラスト・明度調整
- CLAHE（局所適応ヒストグラム平坦化）による夜間画像の強調

### 5. グラフ化・可視化
- 時系列グラフの自動生成（面積の変化）
- 昼夜周期の可視化
- Constant Darkness条件にも対応

## インストール

```bash
pip install -r requirements.txt
```

## 使い方

### 1. GUIの起動

```bash
python animal_detector_gui.py
```

### 2. 基本的な設定手順

1. **画像フォルダを選択**: 解析対象の画像が保存されているフォルダを指定
### 3. 基本的な設定手順

1. **画像フォルダを選択**: 解析対象の画像が保存されているフォルダを指定
2. **代表画像を選択**: 昼・夜それぞれの代表的な画像を選択（パラメータ調整の確認用）
3. **パラメータ設定**:
   - 最小面積・最大面積: 検出対象のサイズ範囲（pixels²）
   - 二値化方法: `relative`を推奨
   - 相対閾値: `0.15`が標準（夜間の誤検出を抑えるには`0.2-0.3`に上げる）
4. **プレビュー確認**: 設定を変更したら「更新」ボタンでプレビューを確認
5. **解析開始**: すべての設定が完了したら「解析開始」をクリック

### 4. 推奨パラメータ設定

#### 基本設定（標準条件）
```
メソッド: relative
相対閾値: 0.15
最小面積: 100
最大面積: 10000
Select Largest Particle: ON (チェック)
自動背景補正: OFF（まず試してから）
```

#### 検出率を上げたい場合
```
相対閾値: 0.10～0.12（低くする）
自動背景補正: ON (adaptive)
エッジ強調: ON (重み 0.3)
ROI: 設定する
```

#### 夜間の誤検出対策（重要）
```
相対閾値: 0.20～0.30（高くする）
ROI: 個体が存在する領域のみに制限
Temporal Median Filter: ON (フレーム数 100)
自動背景補正: OFF（夜間はノイズが増幅される可能性）
CLAHE: OFF（同上）
```

#### 照明条件が安定している場合
```
メソッド: relative
相対閾値: 0.15
背景除去: OFF
コントラスト調整: OFF
```

#### 照明条件が変動する場合
```
メソッド: relative
相対閾値: 0.20
Temporal Median Filter: ON (フレーム数 100)
または
自動背景補正: ON (adaptive)
```

### 5. ターゲット選択機能の使い方

プラナリアをクリックして最適なパラメータを自動推定する機能です。

1. 昼または夜の代表画像を選択
2. 「ターゲット選択」パネルの「選択」ボタンをクリック
3. プレビュー画像上のプラナリアの中心付近をクリック
4. システムが自動的に輝度・面積を解析し、パラメータを推定
5. 「適用」ボタンで推定したパラメータを適用
6. プレビューで確認し、必要に応じて微調整

**Tips**:
- プラナリアの中心を正確にクリックすると検出精度が向上
- ROIを設定してからターゲット選択すると精度が向上
- 昼画像と夜画像で別々にターゲット選択を行うことを推奨

### 6. 行動解析の実行

画像検出が完了したら、behavior_analysis.pyで行動解析を実行できます。

#### GUI版（推奨）
```python
from behavior_analysis import BehaviorAnalyzer
import tkinter as tk
from tkinter import filedialog

# CSVファイルを選択
root = tk.Tk()
root.withdraw()
csv_path = filedialog.askopenfilename(
    title="analysis_results.csvを選択",
    filetypes=[("CSV files", "*.csv")]
)

# 解析実行
analyzer = BehaviorAnalyzer(
    csv_path=csv_path,
    time_interval_minutes=10,  # 集約時間間隔
    day_start_time='07:00',
    night_start_time='19:00',
    measurement_start_time='09:00:00'
)

analyzer.load_data()
analyzer.calculate_movement()
analyzer.calculate_immobility_ratio(immobility_threshold_pixels=3.0)

# グラフ表示
analyzer.create_time_bins()
aggregated_df = analyzer.aggregate_by_time()
analyzer.plot_time_series(aggregated_df)
```

#### 出力ファイル
- `analysis_results.csv`: 検出結果（重心座標、面積、形状など）
- `activity_graph.png`: 時系列グラフ
- `time_config.json`: 時間設定（昼夜の開始時刻など）
- `detection_video.avi`: 検出結果の動画（動画保存を有効にした場合）

### 7. パラメータの意味

### 7. パラメータの意味

#### 二値化設定
- **相対閾値 (relative_thresh)**: 
  - 値が小さいほど検出感度が高い（誤検出も増える）
  - 値が大きいほど検出が厳しくなる（夜間の誤検出を抑制）
  - 推奨範囲: 0.10 ～ 0.30
  - 標準値: 0.15
  
- **定数C (c_value)**: 
  - adaptive方式で使用
  - 値が大きいほど明るい部分が検出されにくい
  
- **ブロックサイズ (block_size)**: 
  - adaptive方式で使用
  - 奇数である必要がある
  - 大きいほど広い範囲の平均を使用

#### 面積フィルタ
- **最小面積**: これより小さいオブジェクトは無視（ノイズ除去）
- **最大面積**: これより大きいオブジェクトは無視
- 単位: pixels²
- 推奨値: 100 ～ 10000（プラナリアのサイズに応じて調整）

#### ROI設定
- 昼の代表画像でマウスドラッグにより円形ROIを設定
- ROI外の領域は検出対象から除外
- 誤検出を大幅に削減できる

#### 背景除去
- **Temporal Median Filter**: 
  - フレーム数: 使用する画像枚数（推奨: 100）
  - 全画像から等間隔に選択して背景を作成
  - 動きの少ないノイズ除去に有効
  
- **自動背景補正**:
  - adaptive: ガウシアンブラーによる高速処理（推奨）
  - morphological: モルフォロジー処理
  - rolling_ball: Rolling Ball法（やや重い）

#### 画像強調
- **コントラスト調整 (Cont)**: 
  - 倍率: 1.0～2.0（推奨: 1.5）
  - 明度: -50～50（推奨: 0）
  
- **CLAHE**: 
  - 制限: 2.0～4.0（推奨: 3.0）
  - 夜間画像の強調に有効だが、ノイズも増幅される
  
- **エッジ強調 (Edge)**: 
  - 重み: 0.2～0.5（推奨: 0.3）
  - 輪郭がぼやけている場合に有効

### 8. 出力ファイルの説明

#### analysis_results.csv
検出結果を記録したCSVファイル。以下の列を含みます：
- `filename`: 画像ファイル名
- `centroid_x`, `centroid_y`: 重心座標（pixels）
- `major_axis`, `minor_axis`: 長軸・短軸（pixels）
- `circularity`: 真円度（0.0～1.0）
- `area`: 面積（pixels²）

#### time_config.json
時間設定を記録したJSONファイル：
```json
{
  "day_start_time": "07:00",
  "night_start_time": "19:00",
  "measurement_start_time": "09:00:00"
}
```

#### activity_graph.png
時系列グラフ（面積の変化）：
- X軸: 時刻
- Y軸: 面積（pixels²）
- 背景: 昼夜周期を色分けして表示（グレー=夜間）
- 赤線: 測定開始時刻

### 9. トラブルシューティング
### 9. トラブルシューティング

#### 誤検出が多い場合
1. **相対閾値を上げる**: 0.15 → 0.25
2. **ROIを設定**: 検出範囲を制限
3. **最小面積を大きくする**: ノイズを除外
4. **Temporal Median Filterを使用**: 背景ノイズを除去

#### 検出できない場合
1. **相対閾値を下げる**: 0.15 → 0.10
2. **自動背景補正を有効化**: adaptive方式を使用
3. **エッジ強調を有効化**: 重み 0.3
4. **ターゲット選択機能を使用**: 自動パラメータ推定

#### 夜間の誤検出が多い場合（最重要）
1. **相対閾値を上げる**: 0.20 ～ 0.30
   - 夜間は照明が暗く、ノイズが相対的に大きく見える
2. **ROIを設定**: 個体が存在する領域のみに制限
3. **Temporal Median Filterを使用**: 動きの少ない背景ノイズを除去
4. **CLAHE・コントラスト調整は無効化**: ノイズが強調される

#### ソフトが落ちる・動作が重い場合
1. **自動背景補正の方式を変更**:
   - morphological → adaptive（最速）
   - rolling_ball → adaptive（最速）
2. **Temporal Median Filterのフレーム数を減らす**: 100 → 50
3. **動画保存を無効化**: 保存が不要な場合
4. **ROIを設定**: 処理範囲を制限

#### ターゲット選択がうまくいかない場合
1. **プラナリアの中心を正確にクリック**: 輪郭ではなく中心付近
2. **先にROIを設定**: ROI内でターゲット選択すると精度向上
3. **代表画像を変更**: プラナリアが明確に写っている画像を選択
4. **自動背景補正を有効化してから試す**: 検出精度が向上

### 10. 検出率向上ガイド

#### まず試すべき設定（無料・簡単）
| 設定 | 推奨値 | 効果 |
|------|--------|------|
| 相対閾値調整 | 0.20～0.30（夜間誤検出対策） | ★★★ |
| ROI設定 | 個体が存在する範囲のみ | ★★★★ |
| ターゲット選択 | プラナリアをクリック | ★★★★ |
| Temporal Median Filter | フレーム数 100 | ★★★★ |
| 自動背景補正 | adaptive方式 | ★★★ |
| エッジ強調 | 重み 0.3 | ★★ |

#### 環境改善（低コスト・高効果）
1. **背景を白無地に変更**: マット仕上げの白い板を使用
2. **照明の位置を調整**: 斜め45度から均一に照射
3. **カメラ設定を固定**: 自動調整（露出・ホワイトバランス）をOFF
4. **反射を抑える**: マット仕上げの背景、拡散照明を使用

#### 本格的な改善（コスト中～高）
1. **赤外線照明の導入**: 昼夜で安定した照明
2. **拡散照明システムの構築**: 影や反射を最小化
3. **専用容器の作成**: 背景一体型、照明一体型

### 11. よくある質問

**Q: 検出率を上げるには何から始めればいい？**
A: まずROI設定とターゲット選択機能を使ってください。これだけで大幅に改善します。

**Q: 夜間の誤検出が多すぎる**
A: 相対閾値を0.25～0.30に上げ、ROIを設定してください。それでも改善しない場合はTemporal Median Filterを使用してください。

**Q: プラナリアが検出されない**
A: ターゲット選択機能でプラナリアをクリックし、「適用」ボタンを押してください。自動的に最適なパラメータが設定されます。

**Q: ソフトが重い・遅い**
A: 自動背景補正の方式を「adaptive」に変更してください。rolling_ballは軽量化されていますが、adaptiveが最速です。

**Q: 行動解析のグラフが表示されない**
A: time_config.jsonファイルが正しく生成されているか確認してください。GUIで解析を実行すると自動的に生成されます。

**Q: 複数個体の追跡は可能？**
A: 現在のバージョンは1個体のみに対応しています。複数個体の場合は「Select Largest Particle」を有効にして最大個体のみを追跡してください。

## 技術仕様

### 処理速度
- 画像検出: 約1～3枚/秒（画像サイズとパラメータに依存）
- 自動背景補正（adaptive）: 約50ms/枚（最速）
- 自動背景補正（morphological）: 約100ms/枚
- Temporal Median Filter: 初回のみ数秒～数十秒

### 精度
- 位置精度: ±1 pixel（サブピクセル精度は未実装）
- 面積精度: 二値化精度に依存（約±5%）
- 検出率: 適切な設定で95%以上（照明条件に大きく依存）

### 対応画像形式
- PNG, JPG, JPEG, BMP
- カラー画像（自動的にグレースケール変換）
- 推奨解像度: 640x480 ～ 1920x1080

### システム要件
- Python 3.8以上
- メモリ: 4GB以上推奨
- OS: Windows, macOS, Linux対応

## ライセンス・引用

このソフトウェアを研究に使用する場合は、以下の情報を引用してください：

```
Planarian Detection System
https://github.com/[your-repo]
```

## 更新履歴

### Version 2.0 (2026-02-05)
- Rolling Ball法の軽量化（OpenCVのみで実装、scikit-image依存を削除）
- ターゲット選択機能の座標変換ロジックを修正
- エラーハンドリングを強化してクラッシュを防止
- 検出アルゴリズムを改善し、精度と速度を向上
- README大幅改定、behavior_analysis解説を追加

### Version 1.5
- 自動背景補正機能を追加
- エッジ強調機能を追加
- 内部均一性フィルタを追加
- ターゲット選択機能を追加
- Temporal Median Filterを追加

### Version 1.0
- 初回リリース
- 基本的な検出機能
- ROI設定機能
- 時系列グラフ生成

## サポート

問題が発生した場合は、以下の情報を含めてIssueを作成してください：
1. エラーメッセージ
2. 使用した画像の例（可能であれば）
3. 設定パラメータ
4. OS・Pythonバージョン

### 4. 個体が複数検出される場合
- 「Select Largest Particle」にチェック
- 最小面積を大きくして小さなノイズを除外

## パラメータ設定ガイド

### relative_thresh（相対閾値）の効果
- **値が小さい（0.05 ～ 0.10）**: 
  - 検出感度が高い
  - 小さな輝度差でも検出
  - 誤検出が増える傾向
- **値が中程度（0.15 ～ 0.20）**: 
  - バランスが取れた設定
  - 標準的な使用に推奨
- **値が大きい（0.25 ～ 0.35）**: 
  - 検出が厳しくなる
  - 夜間の誤検出を抑制
  - 見逃しが増える可能性

### なぜrelative方式が夜間誤検出に強いか
1. **画像ごとに閾値が自動調整される**
   - 夜間の暗い画像では閾値も自動的に低くなる
   - 相対的な輝度差のみを検出
   
2. **相対閾値で感度を調整可能**
   - 固定閾値では夜間に過検出になりがち
   - relative方式なら閾値を上げるだけで夜間の誤検出を抑制

3. **計算式**:
   ```
   閾値 = 平均輝度 × (1 - relative_thresh)
   ```
   - 例: 平均輝度が100の場合
     - relative_thresh=0.15 → 閾値=85
     - relative_thresh=0.30 → 閾値=70
   - 夜間（平均輝度30）の場合
     - relative_thresh=0.15 → 閾値=25.5
     - relative_thresh=0.30 → 閾値=21

### methodの選び方
- **relative（推奨）**: 
  - ほとんどの場合に最適
  - 照明条件の変動に強い
  - パラメータ調整が簡単（relative_threshのみ）
  
- **adaptive**: 
  - 局所的に照明が異なる場合に有効
  - パラメータが多く調整が難しい
  - 計算コストが高い
  
- **fixed**: 
  - 照明条件が完全に一定の場合のみ
  - 一般的には非推奨

## 設定の保存・読み込み

- **設定保存**: 現在のパラメータをJSONファイルとして保存
- **設定ロード**: 保存した設定を読み込み

同じ実験条件で複数回解析を行う場合に便利です。

## トラブルシューティング

### Q: 夜間に誤検出が多い
A: 
1. 相対閾値を0.20以上に上げる
2. ROIを設定して検出範囲を制限
3. Temporal Median Filterを使用

### Q: 個体が検出されない
A:
1. 相対閾値を下げる（0.10程度）
2. 最小面積を小さくする
3. コントラスト調整を試す

### Q: 背景のノイズが検出される
A:
1. 最小面積を大きくする
2. ROIを設定
3. Temporal Median Filterを使用

### Q: 動画保存が失敗する
A:
- OpenCVのコーデック(XVID)が必要
- スケールを小さく（0.5以下）してファイルサイズを削減

## 技術的詳細

### 検出アルゴリズム
1. 前処理（オプション）:
   - ROIマスク適用
   - Temporal Median背景除去
   - コントラスト調整
2. 二値化:
   - relative方式: `threshold = mean * (1 - relative_thresh)`
   - adaptive方式: 局所的に閾値を設定
3. 輪郭検出:
   - 面積フィルタを適用
   - 最大面積または中心に最も近い個体を選択
4. 形状測定:
   - 重心、面積、長軸・短軸、真円度を計算

### relative方式の利点
- 照明条件の変動に強い（画像ごとに閾値が自動調整される）
- 夜間の誤検出を抑制（相対閾値を上げることで感度を調整可能）
- 計算が軽い

## 開発者向け情報

### ファイル構成
- `animal_detector_gui.py`: メインGUIアプリケーション
- `behavior_analysis.py`: 行動解析用スクリプト（将来の拡張用）
- `requirements.txt`: 必要なPythonパッケージ

### 主要な関数
- `binarize()`: 二値化処理
- `analyze()`: 個体検出・形状測定
- `create_temporal_median_background()`: Temporal Median背景作成
- `enhance_contrast()`: コントラスト調整

## 検出能力を上げる方法（重要）

検出精度を向上させるには、**画像処理の改善**と**画像取得環境の改善**の両方が重要です。

### A. 画像処理による改善（すぐ実装可能）

#### 1. エッジ強調（新機能）
個体の輪郭を強調して検出率を向上させます。

```
設定:
- エッジ強調: チェック
- 重み: 0.3 ～ 0.5（大きいほど輪郭が強調される）
```

**効果**:
- ぼやけた個体の輪郭が明確になる
- 背景との境界が曖昧な場合に有効
- コントラストが低い画像で特に効果的

**注意**:
- 重みを大きくしすぎるとノイズも強調される
- 夜間は慎重に使用（0.2～0.3程度）

#### 2. CLAHE（局所適応ヒストグラム平坦化）
照明ムラがある場合に有効です。

```
設定:
- CLAHE: チェック
- 制限: 2.0 ～ 3.0
```

**効果**:
- 局所的に暗い領域でも個体を検出可能
- 照明が不均一な場合に効果的

#### 3. Temporal Median Filter
動きの少ない背景ノイズを除去します。

```
設定:
- 使用: チェック
- フレーム数: 100 ～ 200
- 背景作成ボタンをクリック
```

**効果**:
- 背景の反射や汚れを除去
- 夜間の誤検出を大幅に削減

#### 4. 組み合わせ例

**標準設定（昼間・照明良好）**:
```
メソッド: relative
相対閾値: 0.15
エッジ強調: OFF
CLAHE: OFF
```

**照明が不均一な場合**:
```
メソッド: relative
相対閾値: 0.15
エッジ強調: ON（重み 0.3）
CLAHE: ON（制限 2.5）
```

**夜間・低コントラスト**:
```
メソッド: relative
相対閾値: 0.25
エッジ強調: ON（重み 0.2）
CLAHE: OFF
Temporal Median Filter: ON
```

### B. 画像取得環境の改善（最も効果的）

画像処理には限界があります。以下の環境改善により、**根本的に検出精度が向上**します。

#### 1. 照明の改善（最重要）

**推奨設定**:
- **赤外線照明の使用**: 個体に影響を与えず、24時間安定した照明
- **拡散照明**: 直接照明は避け、反射板で拡散させる
- **照度の統一**: 昼夜で照度を一定に保つ（赤外線カメラ使用時）

**照明の配置**:
```
悪い例: カメラ上部から直接照明 → 反射、影が多い
良い例: 斜め45度から拡散照明 → 均一な照度、影が少ない
最良例: リング照明またはバックライト → 最も均一
```

#### 2. 背景の改善

**推奨背景**:
- **均一な色**: 白または黒の無地背景
- **マット仕上げ**: 反射を避ける
- **個体とのコントラスト**: 個体が暗い場合は白背景、明るい場合は黒背景

**NG背景**:
- 模様がある
- 光沢がある（反射する）
- 汚れや傷が多い

#### 3. カメラ設定の最適化

**推奨設定**:
```
解像度: 640x480 以上（個体サイズに応じて）
フレームレート: 0.1 FPS（10秒に1枚）で十分
露出: 自動露出OFF、マニュアル固定
ホワイトバランス: 固定
フォーカス: マニュアルフォーカス固定
```

**重要**: 自動調整機能をすべてOFFにして、撮影条件を固定する

#### 4. 容器・環境の改善

**推奨環境**:
- 透明な容器を使用（ガラスまたはアクリル）
- 容器外側に背景板を設置
- 水の濁りを最小限に
- 気泡の混入を避ける
- 振動を避ける

#### 5. 撮影タイミング

**推奨**:
- 個体が動いていない時を狙う（フレーム間差分も検討）
- 給餌後は避ける（水の濁りのため）

### C. 効果の比較

| 改善方法 | コスト | 効果 | 難易度 |
|---------|--------|------|--------|
| 相対閾値調整 | 無料 | ★★★ | 簡単 |
| エッジ強調 | 無料 | ★★★ | 簡単 |
| CLAHE | 無料 | ★★ | 簡単 |
| Temporal Median | 無料 | ★★★★ | 簡単 |
| ROI設定 | 無料 | ★★★★ | 簡単 |
| 照明改善 | 低～中 | ★★★★★ | 中 |
| 背景改善 | 低 | ★★★★★ | 簡単 |
| カメラ設定 | 無料 | ★★★★ | 簡単 |
| 赤外線カメラ | 高 | ★★★★★ | 中～高 |
## ライセンス

（適宜追加してください）

## 更新履歴

- 2025-01-16: 
  - relative方式の二値化を実装
  - 夜間誤検出対策を強化
  - README作成

